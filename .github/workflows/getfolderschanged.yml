name : getallchangedfiles
on : 
  pull_request:
    
    
jobs :
  commitjob: 
    runs-on: ubuntu-latest
    steps : 
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: '0'
    - name : getbranch
      run : echo "branchin=${{ github.head_ref }}" 
    # - name: Setup tmate session
    #   uses: mxschmitt/action-tmate@v3
    - name : getfoldersunderDataFolder
      run : |
        echo "check"
        value=$(git diff origin/master origin/${{ github.head_ref }} --name-only | { grep DataFolder/apac-stage || true; } )
        echo $value
        if [[ -n $value ]]
        then 
          echo "true"
          echo "trigger_apac=true" >> $GITHUB_ENV
        else
          echo "false"
          echo "trigger_apac=false" >> $GITHUB_ENV
        fi

        
        value2=$(git diff origin/master origin/${{ github.head_ref }} --name-only | { grep DataFolder/emea-stage/ || true; } )
        if [[ -n $value2 ]]
        then 
          echo "trigger_emea=true" >> $GITHUB_ENV
        else
          echo "trigger_emea=false" >> $GITHUB_ENV
        fi
    outputs:
      RUN_APAC : ${{ env.trigger_apac }}
      RUN_EMEA : ${{ env.trigger_emea }}

  apacJob:
    needs : commitjob
    if :  needs.commitjob.outputs.RUN_APAC == 'true'
    runs-on: ubuntu-latest
    steps : 
    - name: checktrigger
      run : echo ${{ needs.commitjob.outputs.RUN_APAC }}
    - name : sync
      run : |
        arr=()
        for i in $(ls -d DataFolder/apac-stage/*/); do arr+=($i); done
        for value in "${arr[@]}"
        do 
          echo $value
        done
  
  emeaJob :
    needs : commitjob
    if : needs.commitjob.outputs.RUN_EMEA == 'true'
    runs-on : ubuntu-latest
    steps :
    - name: checktrigger
      run : echo ${{ needs.commitjob.outputs.RUN_EMEA }}
    - name : sync
      run : |
        arr=()
        for i in $(ls -d DataFolder/apac-stage/*/); do arr+=($i); done
        for value in "${arr[@]}"
        do 
          echo $value
        done